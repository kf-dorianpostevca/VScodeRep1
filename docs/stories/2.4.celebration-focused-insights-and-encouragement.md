# Story 2.4: Celebration-Focused Insights and Encouragement

## Parent Epic
[Epic 2: Intelligent Time Tracking & Analytics](../prd/epic-2-intelligent-time-tracking-analytics.md)

## Status
Done

## Story
**As a** user seeking positive productivity reinforcement,
**I want** insights that celebrate achievements and provide gentle guidance,
**so that** I maintain motivation without developing productivity anxiety.

## Acceptance Criteria
1. Monthly summaries lead with accomplishments and positive trends
2. Improvement suggestions framed as opportunities rather than criticisms
3. Recognition of consistency streaks and milestone achievements
4. Gentle reminders about abandoned tasks without guilt-inducing language
5. Contextual encouragement based on recent productivity patterns
6. Option to disable insights for users preferring raw data only

## Tasks / Subtasks
- [x] Create Configuration data model and repository (AC: 6)
  - [x] Define Configuration interface in `packages/shared/src/models/Configuration.ts`
  - [x] Create IConfigurationRepository interface with CRUD operations
  - [x] Implement SQLiteConfigurationRepository with better-sqlite3
  - [x] Add singleton pattern for configuration (single row per user)
  - [x] Ensure configuration table schema matches data model
  - [x] Add comprehensive JSDoc documentation

- [x] Implement InsightGenerationService in shared package (AC: 1, 2, 3, 4, 5)
  - [x] Create `packages/shared/src/services/InsightGenerationService.ts`
  - [x] Implement generateCelebrationMessage method with three tone levels
  - [x] Implement detectMilestones method for achievement recognition
  - [x] Implement generateGentleReminders method for abandoned tasks
  - [x] Implement generateImprovementSuggestions method with positive framing
  - [x] Implement generateContextualEncouragement based on patterns
  - [x] Support three tone preferences: 'enthusiastic', 'gentle', 'professional'
  - [x] Add comprehensive JSDoc documentation

- [x] Implement milestone detection logic (AC: 3)
  - [x] Create detectTaskCountMilestones method (1st, 10th, 50th, 100th, 500th tasks)
  - [x] Create detectStreakMilestones method (3, 7, 14, 30, 60 day streaks)
  - [x] Create detectAccuracyMilestones method (80%, 90%, 95% accuracy)
  - [x] Create detectConsistencyMilestones method (monthly streak improvements)
  - [x] Generate celebration messages for each milestone type
  - [x] Store milestone achievements to avoid duplicate celebrations

- [x] Create celebration message templates (AC: 1, 2)
  - [x] Define EnthusiasticToneMessages with emojis and exclamations
  - [x] Define GentleToneMessages with softer language
  - [x] Define ProfessionalToneMessages with formal tone
  - [x] Create template selection logic based on user preference
  - [x] Ensure all templates lead with accomplishments
  - [x] Frame challenges as opportunities in all tones

- [x] Implement gentle reminder system (AC: 4)
  - [x] Create findAbandonedTasks method (>7 days without completion)
  - [x] Generate reminder messages avoiding guilt language
  - [x] Suggest specific actions without pressure
  - [x] Include positive context (other achievements)
  - [x] Allow dismissing reminders for specific tasks
  - [x] Respect user's enableInsights preference

- [x] Implement improvement suggestion generator (AC: 2)
  - [x] Analyze estimation accuracy patterns
  - [x] Identify opportunities for time estimation improvement
  - [x] Recognize productivity day patterns for optimization
  - [x] Suggest task breakdown strategies for large tasks
  - [x] Frame all suggestions as opportunities, not criticisms
  - [x] Provide actionable next steps with examples

- [x] Implement contextual encouragement engine (AC: 5)
  - [x] Detect improving trends and celebrate progress
  - [x] Detect declining trends with supportive messaging
  - [x] Recognize consistent performance with validation
  - [x] Provide encouragement during learning phases
  - [x] Adjust messaging based on recent patterns (last 2 weeks)
  - [x] Balance celebration with realistic motivation

- [x] Create todo config command (AC: 6)
  - [x] Create `packages/cli/src/commands/config.ts`
  - [x] Add --celebration-language flag (enthusiastic|gentle|professional)
  - [x] Add --enable-insights flag for toggling insights
  - [x] Add --disable-insights flag for raw data preference
  - [x] Add --show flag to display current configuration
  - [x] Add --reset flag to restore defaults
  - [x] Implement celebration-focused confirmation messages

- [x] Integrate InsightGenerationService with MonthlySummaryService (AC: 1, 5)
  - [x] Enhance generateMonthlySummary to use InsightGenerationService
  - [x] Replace simple celebration messages with contextual insights
  - [x] Include milestone achievements in monthly summary
  - [x] Add gentle reminders section to monthly output
  - [x] Add improvement suggestions section to monthly output
  - [x] Respect user's configuration preferences

- [x] Enhance MonthlySummaryFormatter with insights sections (AC: 1, 2, 3, 4)
  - [x] Add formatMilestoneAchievements section
  - [x] Add formatGentleReminders section (if any)
  - [x] Add formatImprovementSuggestions section
  - [x] Add formatContextualEncouragement section
  - [x] Ensure insights are optional based on configuration
  - [x] Maintain celebration-focused layout and tone

- [x] Write comprehensive unit tests (Testing Standards)
  - [x] Create `packages/shared/__tests__/models/Configuration.test.ts`
  - [x] Create `packages/shared/__tests__/repositories/SQLiteConfigurationRepository.test.ts`
  - [x] Create `packages/shared/__tests__/services/InsightGenerationService.test.ts`
  - [x] Create `packages/cli/__tests__/commands/config.test.ts`
  - [x] Test celebration message generation for all three tones
  - [x] Test milestone detection with various achievement patterns
  - [x] Test gentle reminder generation avoiding guilt language
  - [x] Test improvement suggestions framed positively
  - [x] Test contextual encouragement based on patterns
  - [x] Test configuration persistence and retrieval

- [x] Write integration tests (Testing Standards)
  - [x] Add insights workflow tests to `packages/cli/__tests__/integration/cli-workflow.test.ts`
  - [x] Test end-to-end: create tasks ‚Üí milestones ‚Üí monthly with insights
  - [x] Test configuration changes affecting output
  - [x] Test insights disabled (raw data only)
  - [x] Test abandoned task reminders
  - [x] Test tone preference changes across all output

## Dev Notes

### Previous Story Insights

Story 2.3 (Historical Monthly Reports and Trends) provides:
- Historical trend data retrieval with getHistoricalTrends method for pattern recognition [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md]
- Month-over-month comparison logic with TrendIndicator data structure [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md#month-over-month-trend-calculation]
- Trend direction detection (up/down/stable) with thresholds [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md#month-over-month-trend-calculation]
- SparklineData visualization for compact trend display [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md#ascii-sparkline-visualization]
- Missing month handling patterns with graceful messaging [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md#missing-month-handling]
- Overall trend analysis for 6-month periods [Source: docs/stories/2.3.historical-monthly-reports-and-trends.md#6-month-historical-trends-retrieval]

Story 2.2 (Monthly Progress Summary Generation) provides:
- MonthlySummaryService with celebrationMessage field for basic messaging [Source: docs/stories/2.2.monthly-progress-summary-generation.md]
- MonthlySummaryFormatter for output formatting patterns [Source: docs/stories/2.2.monthly-progress-summary-generation.md#monthly-command-specifications]
- Productivity streak calculation for consistency recognition [Source: docs/stories/2.2.monthly-progress-summary-generation.md#productivity-streak-calculation]
- Most productive day identification for pattern insights [Source: docs/stories/2.2.monthly-progress-summary-generation.md#most-productive-day-calculation]
- Celebration message generation patterns for different performance levels [Source: docs/stories/2.2.monthly-progress-summary-generation.md#celebration-message-generation]
- Weekly completion chart visualization [Source: docs/stories/2.2.monthly-progress-summary-generation.md#ascii-chart-implementation]

Story 2.1 (Duration Calculation and Time Estimation Learning) provides:
- EstimationAccuracyService for improvement tracking and trend detection [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md]
- `todo stats` command pattern for analytics commands [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md#cli-command-specifications]
- Celebration-focused messaging patterns for accuracy improvements [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md#celebration-focused-messaging]
- Trend calculation comparing current vs previous period [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md#estimationaccuracyservice-implementation]

Key technical components available for reuse:
- `packages/shared/src/services/MonthlySummaryService.ts` - Service to integrate with InsightGenerationService [Source: docs/stories/2.2.monthly-progress-summary-generation.md#file-locations]
- `packages/shared/src/services/EstimationAccuracyService.ts` - Accuracy data for improvement suggestions [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md#file-locations]
- `packages/cli/src/formatters/MonthlySummaryFormatter.ts` - Formatter to enhance with insights sections [Source: docs/stories/2.2.monthly-progress-summary-generation.md#file-locations]
- `packages/cli/src/formatters/StatsFormatter.ts` - Celebration messaging patterns [Source: docs/stories/2.1.duration-calculation-and-time-estimation-learning.md#file-locations]

### Data Models

**Configuration Model:** User preferences for celebration-focused messaging and insights display. [Source: docs/architecture/data-models.md#configuration]

**Key Attributes:**
- id: string - Single row identifier (singleton pattern for single-user MVP)
- defaultEstimateMinutes: number - Default time estimate for quick task creation
- celebrationLanguage: 'enthusiastic' | 'gentle' | 'professional' - Tone preference for all messaging
- dateFormat: string - Display format preference (ISO, US, EU)
- timeFormat: string - 12h/24h preference
- enableInsights: boolean - Toggle for celebration messaging and suggestions (AC: 6)
- exportFormat: string - Default format for data exports
- lastSummaryGenerated: Date | null - Optimization for monthly report timing
- createdAt: Date - Timestamp for configuration creation
- updatedAt: Date - Timestamp for configuration changes

**Relationships:**
- Configuration affects Task display formatting across all interfaces
- Configuration controls MonthlySummary generation behavior and insight inclusion
- Configuration enables consistent CLI/web interface behavior
- Configuration controls InsightGenerationService tone and output

**TypeScript Interface:**
```typescript
/**
 * User configuration and preferences.
 * Singleton pattern - single row per user for MVP.
 */
interface Configuration {
  id: string;
  defaultEstimateMinutes: number;
  celebrationLanguage: 'enthusiastic' | 'gentle' | 'professional';
  dateFormat: string;
  timeFormat: string;
  enableInsights: boolean;
  exportFormat: string;
  lastSummaryGenerated: Date | null;
  createdAt: Date;
  updatedAt: Date;
}

/**
 * Input for creating or updating configuration
 */
interface ConfigurationUpdate {
  defaultEstimateMinutes?: number;
  celebrationLanguage?: 'enthusiastic' | 'gentle' | 'professional';
  dateFormat?: string;
  timeFormat?: string;
  enableInsights?: boolean;
  exportFormat?: string;
  lastSummaryGenerated?: Date | null;
}
```

**MonthlySummary Model Enhancement:** Existing model extended with insight fields. [Source: docs/architecture/data-models.md#monthlysummary]

**Enhanced Attributes:**
- celebrationMessage: string - Enhanced with contextual insights from InsightGenerationService
- milestoneAchievements: string[] - Array of milestone achievement messages (new)
- improvementSuggestions: string[] - Array of positively-framed suggestions (new)
- gentleReminders: string[] - Array of non-guilt reminders for abandoned tasks (new)

### Database Schema

**configuration Table:** Singleton table for user preferences. [Source: docs/architecture/database-schema.md]

```sql
-- Configuration table - User preferences and settings
CREATE TABLE configuration (
    id TEXT PRIMARY KEY DEFAULT 'singleton',
    default_estimate_minutes INTEGER NOT NULL DEFAULT 30,
    celebration_language TEXT NOT NULL DEFAULT 'enthusiastic'
        CHECK (celebration_language IN ('enthusiastic', 'gentle', 'professional')),
    date_format TEXT NOT NULL DEFAULT 'ISO',
    time_format TEXT NOT NULL DEFAULT '24h',
    enable_insights BOOLEAN NOT NULL DEFAULT TRUE,
    export_format TEXT NOT NULL DEFAULT 'json',
    last_summary_generated DATETIME NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Ensure single row constraint
CREATE TRIGGER configuration_single_row_insert
    BEFORE INSERT ON configuration
    FOR EACH ROW
    WHEN (SELECT COUNT(*) FROM configuration) >= 1
BEGIN
    SELECT RAISE(FAIL, 'Only one configuration row allowed');
END;

-- Update timestamp trigger
CREATE TRIGGER configuration_update_timestamp
    AFTER UPDATE ON configuration
    FOR EACH ROW
BEGIN
    UPDATE configuration
    SET updated_at = CURRENT_TIMESTAMP
    WHERE id = NEW.id;
END;

-- Insert default configuration
INSERT OR IGNORE INTO configuration (id) VALUES ('singleton');
```

**Key Schema Features:**
- Single row constraint enforced via trigger
- CHECK constraint on celebration_language values
- Default values for all preferences
- Automatic timestamp management
- Automatic insertion of default configuration

**Database Operations:**
```sql
-- Get configuration (always exists due to default insert)
SELECT * FROM configuration WHERE id = 'singleton';

-- Update configuration
UPDATE configuration
SET
    celebration_language = ?,
    enable_insights = ?,
    updated_at = CURRENT_TIMESTAMP
WHERE id = 'singleton';

-- Reset to defaults
UPDATE configuration
SET
    default_estimate_minutes = 30,
    celebration_language = 'enthusiastic',
    enable_insights = TRUE,
    updated_at = CURRENT_TIMESTAMP
WHERE id = 'singleton';
```

### Insight Generation Service Architecture

**Service Location:** `packages/shared/src/services/InsightGenerationService.ts` [Source: docs/architecture/source-tree.md]

**Core Service Methods:**
```typescript
/**
 * Service for generating celebration-focused insights and encouragement.
 * Provides contextual motivation without inducing productivity anxiety.
 */
export class InsightGenerationService {
  /**
   * Generate celebration message based on performance and tone preference.
   * Leads with accomplishments and frames challenges positively.
   *
   * @param summary - Monthly summary data
   * @param config - User configuration for tone preference
   * @param trends - Optional historical trends for context
   * @returns Celebration message string
   * @example
   * const message = service.generateCelebrationMessage(summary, config);
   * // "üåü Outstanding month! You completed 85% of your tasks..."
   */
  generateCelebrationMessage(
    summary: MonthlySummary,
    config: Configuration,
    trends?: HistoricalTrends
  ): string;

  /**
   * Detect and celebrate milestone achievements.
   * Recognizes task counts, streaks, accuracy, and consistency milestones.
   *
   * @param summary - Current monthly summary
   * @param totalTasksAllTime - Total task count for milestone detection
   * @param previousMilestones - Previously achieved milestones to avoid duplicates
   * @returns Array of milestone achievement messages
   * @example
   * const milestones = service.detectMilestones(summary, 50, []);
   * // ["üéâ 50th task completed! You're building great momentum!"]
   */
  detectMilestones(
    summary: MonthlySummary,
    totalTasksAllTime: number,
    previousMilestones: string[]
  ): string[];

  /**
   * Generate gentle reminders for abandoned tasks.
   * Avoids guilt-inducing language and provides supportive context.
   *
   * @param abandonedTasks - Tasks without completion >7 days
   * @param config - User configuration for tone and enablement
   * @returns Array of gentle reminder messages
   * @example
   * const reminders = service.generateGentleReminders(tasks, config);
   * // ["üí≠ You have 3 tasks from last week. No pressure - revisit when ready!"]
   */
  generateGentleReminders(
    abandonedTasks: Task[],
    config: Configuration
  ): string[];

  /**
   * Generate improvement suggestions framed as opportunities.
   * Analyzes patterns and provides actionable guidance without criticism.
   *
   * @param summary - Monthly summary data
   * @param accuracy - Estimation accuracy data
   * @param config - User configuration for tone preference
   * @returns Array of improvement suggestion messages
   * @example
   * const suggestions = service.generateImprovementSuggestions(summary, accuracy, config);
   * // ["üí° Try breaking large tasks into smaller chunks for better time estimates"]
   */
  generateImprovementSuggestions(
    summary: MonthlySummary,
    accuracy: AccuracyStats,
    config: Configuration
  ): string[];

  /**
   * Generate contextual encouragement based on recent patterns.
   * Adjusts messaging based on trends, performance, and learning phase.
   *
   * @param summary - Current monthly summary
   * @param trends - Historical trends for pattern recognition
   * @param config - User configuration for tone preference
   * @returns Contextual encouragement message
   * @example
   * const encouragement = service.generateContextualEncouragement(summary, trends, config);
   * // "üìà You're improving! Completion rate up 12% from last month."
   */
  generateContextualEncouragement(
    summary: MonthlySummary,
    trends: HistoricalTrends,
    config: Configuration
  ): string;
}
```

### Celebration Tone Preferences

**Three Tone Levels:** [AC: 1, 2]

**1. Enthusiastic Tone:**
```typescript
const EnthusiasticMessages = {
  highPerformance: "üåü Outstanding month! You absolutely crushed it with {rate}% completion! üéâ",
  goodPerformance: "üéØ Fantastic work! {count} tasks completed - you're on fire! üî•",
  learningPhase: "üìö Great progress! You completed {count} tasks and you're building momentum! üí™",
  improvement: "üìà Wow! Up {change}% from last month - you're getting better and better! ‚≠ê",
  milestone: "üéä MILESTONE ALERT! You just hit your {milestone} - that's AMAZING! üöÄ",
  gentleReminder: "üí≠ Hey! You have {count} tasks from last week waiting for some love! No rush though! üòä",
  suggestion: "üí° PRO TIP: Try breaking those big tasks into bite-sized pieces - you'll love the progress! üéØ"
};
```

**2. Gentle Tone:**
```typescript
const GentleMessages = {
  highPerformance: "‚ú® What a lovely month! You completed {rate}% of your tasks with grace.",
  goodPerformance: "üå∏ Nice work! {count} tasks done - you're finding your rhythm.",
  learningPhase: "üå± You're growing! {count} tasks completed as you learn your patterns.",
  improvement: "üìä Gentle progress: up {change}% from last month. Keep being kind to yourself.",
  milestone: "üéà You reached your {milestone} - a quiet achievement worth celebrating.",
  gentleReminder: "üí≠ {count} tasks from last week are resting. Revisit them when you're ready.",
  suggestion: "üí° Consider: smaller tasks might feel more manageable for your workflow."
};
```

**3. Professional Tone:**
```typescript
const ProfessionalMessages = {
  highPerformance: "Excellent performance this month: {rate}% task completion rate achieved.",
  goodPerformance: "Strong results: {count} tasks completed with consistent execution.",
  learningPhase: "Progress noted: {count} tasks completed as you refine your approach.",
  improvement: "Performance improvement: {change}% increase in completion rate month-over-month.",
  milestone: "Milestone reached: {milestone}. This demonstrates consistent productivity habits.",
  gentleReminder: "{count} pending tasks from last week require attention at your convenience.",
  suggestion: "Recommendation: Consider task decomposition strategies for improved estimation accuracy."
};
```

**Tone Selection Logic:**
```typescript
/**
 * Select appropriate message template based on user's tone preference.
 *
 * @param config - User configuration with celebrationLanguage
 * @param messageType - Type of message to generate
 * @param variables - Variables to interpolate into message
 * @returns Formatted message string
 */
private selectMessage(
  config: Configuration,
  messageType: string,
  variables: Record<string, any>
): string {
  const templates = {
    enthusiastic: EnthusiasticMessages,
    gentle: GentleMessages,
    professional: ProfessionalMessages
  };

  const template = templates[config.celebrationLanguage][messageType];
  return this.interpolateVariables(template, variables);
}
```

### Milestone Detection Logic

**Milestone Categories:** [AC: 3]

**1. Task Count Milestones:**
```typescript
/**
 * Detect task count milestones (1st, 10th, 50th, 100th, 500th, 1000th).
 * Celebrates consistent task creation and completion.
 *
 * @param totalTasksAllTime - Total task count across all time
 * @param previousMilestones - Previously celebrated milestones
 * @returns Array of milestone messages
 */
private detectTaskCountMilestones(
  totalTasksAllTime: number,
  previousMilestones: string[]
): string[] {
  const milestones = [1, 10, 50, 100, 500, 1000];
  const newMilestones: string[] = [];

  for (const milestone of milestones) {
    const milestoneKey = `task_count_${milestone}`;

    if (totalTasksAllTime >= milestone && !previousMilestones.includes(milestoneKey)) {
      newMilestones.push(milestoneKey);
    }
  }

  return newMilestones.map(key => this.formatTaskMilestone(parseInt(key.split('_')[2])));
}

/**
 * Format task count milestone message.
 */
private formatTaskMilestone(count: number): string {
  const messages = {
    1: "üéâ First task completed! This is the start of something great!",
    10: "üéØ 10 tasks done! You're building momentum!",
    50: "üåü 50 tasks completed! Consistency is your superpower!",
    100: "üíØ 100 tasks! You've mastered the art of getting things done!",
    500: "üöÄ 500 tasks completed! You're a productivity champion!",
    1000: "üèÜ 1000 TASKS! This is legendary status!"
  };

  return messages[count] || `üéä ${count} tasks completed - incredible milestone!`;
}
```

**2. Streak Milestones:**
```typescript
/**
 * Detect productivity streak milestones (3, 7, 14, 30, 60 day streaks).
 * Celebrates consistency and habit formation.
 *
 * @param currentStreak - Current productivity streak length
 * @param previousMilestones - Previously celebrated milestones
 * @returns Array of milestone messages
 */
private detectStreakMilestones(
  currentStreak: number,
  previousMilestones: string[]
): string[] {
  const milestones = [3, 7, 14, 30, 60];
  const newMilestones: string[] = [];

  for (const milestone of milestones) {
    const milestoneKey = `streak_${milestone}`;

    if (currentStreak >= milestone && !previousMilestones.includes(milestoneKey)) {
      newMilestones.push(milestoneKey);
    }
  }

  return newMilestones.map(key => this.formatStreakMilestone(parseInt(key.split('_')[1])));
}

/**
 * Format streak milestone message.
 */
private formatStreakMilestone(days: number): string {
  const messages = {
    3: "üî• 3-day streak! You're forming a habit!",
    7: "‚≠ê Week-long streak! Consistency is key!",
    14: "üí™ 2-week streak! You're unstoppable!",
    30: "üèÖ 30-day streak! This is incredible discipline!",
    60: "üëë 60-day streak! You're a consistency master!"
  };

  return messages[days] || `üî• ${days}-day streak - amazing consistency!`;
}
```

**3. Accuracy Milestones:**
```typescript
/**
 * Detect estimation accuracy milestones (80%, 90%, 95%).
 * Celebrates time estimation skill improvement.
 *
 * @param accuracy - Current estimation accuracy percentage
 * @param previousMilestones - Previously celebrated milestones
 * @returns Array of milestone messages
 */
private detectAccuracyMilestones(
  accuracy: number | null,
  previousMilestones: string[]
): string[] {
  if (accuracy === null) return [];

  const milestones = [80, 90, 95];
  const newMilestones: string[] = [];

  for (const milestone of milestones) {
    const milestoneKey = `accuracy_${milestone}`;

    if (accuracy >= milestone && !previousMilestones.includes(milestoneKey)) {
      newMilestones.push(milestoneKey);
    }
  }

  return newMilestones.map(key => this.formatAccuracyMilestone(parseInt(key.split('_')[1])));
}

/**
 * Format accuracy milestone message.
 */
private formatAccuracyMilestone(percentage: number): string {
  const messages = {
    80: "üéì 80% estimation accuracy! You're learning your pace!",
    90: "üéØ 90% accuracy! Your time estimates are spot-on!",
    95: "üèÜ 95% accuracy! You're a time estimation master!"
  };

  return messages[percentage] || `üéØ ${percentage}% accuracy - excellent estimation!`;
}
```

**4. Consistency Milestones:**
```typescript
/**
 * Detect consistency improvement milestones.
 * Celebrates sustained streak improvements month-over-month.
 *
 * @param currentStreak - Current month's longest streak
 * @param previousStreak - Previous month's longest streak
 * @param previousMilestones - Previously celebrated milestones
 * @returns Array of milestone messages
 */
private detectConsistencyMilestones(
  currentStreak: number,
  previousStreak: number | null,
  previousMilestones: string[]
): string[] {
  if (previousStreak === null) return [];

  const improvement = currentStreak - previousStreak;

  if (improvement >= 5) {
    const milestoneKey = `consistency_improved_${currentStreak}`;

    if (!previousMilestones.includes(milestoneKey)) {
      return [`üå± Consistency growing! Streak improved by ${improvement} days month-over-month!`];
    }
  }

  return [];
}
```

### Gentle Reminder Generation

**Abandoned Task Detection:** [AC: 4]

```typescript
/**
 * Find tasks that haven't been completed in over 7 days.
 * These are candidates for gentle reminders.
 *
 * @param tasks - All incomplete tasks
 * @returns Tasks created >7 days ago without completion
 */
private findAbandonedTasks(tasks: Task[]): Task[] {
  const sevenDaysAgo = new Date();
  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

  return tasks.filter(task =>
    !task.isCompleted &&
    task.createdAt < sevenDaysAgo
  );
}

/**
 * Generate gentle reminders for abandoned tasks.
 * Avoids guilt-inducing language and provides context.
 *
 * @param abandonedTasks - Tasks >7 days old without completion
 * @param config - User configuration for tone and enablement
 * @returns Array of gentle reminder messages
 */
generateGentleReminders(
  abandonedTasks: Task[],
  config: Configuration
): string[] {
  // Respect user preference
  if (!config.enableInsights) return [];

  // No reminders if no abandoned tasks
  if (abandonedTasks.length === 0) return [];

  const reminders: string[] = [];

  // Group by age for contextual messaging
  const sevenDaysOld = abandonedTasks.filter(t =>
    this.getDaysOld(t) >= 7 && this.getDaysOld(t) < 14
  );
  const fourteenDaysOld = abandonedTasks.filter(t =>
    this.getDaysOld(t) >= 14 && this.getDaysOld(t) < 30
  );
  const thirtyDaysOld = abandonedTasks.filter(t =>
    this.getDaysOld(t) >= 30
  );

  // 7-14 days: Gentle nudge
  if (sevenDaysOld.length > 0) {
    reminders.push(this.formatReminder(
      sevenDaysOld.length,
      'week',
      config.celebrationLanguage
    ));
  }

  // 14-30 days: Supportive check-in
  if (fourteenDaysOld.length > 0) {
    reminders.push(this.formatReminder(
      fourteenDaysOld.length,
      'two_weeks',
      config.celebrationLanguage
    ));
  }

  // 30+ days: Option to archive
  if (thirtyDaysOld.length > 0) {
    reminders.push(this.formatReminder(
      thirtyDaysOld.length,
      'month',
      config.celebrationLanguage
    ));
  }

  return reminders;
}

/**
 * Format reminder message based on age and tone.
 */
private formatReminder(
  count: number,
  age: 'week' | 'two_weeks' | 'month',
  tone: 'enthusiastic' | 'gentle' | 'professional'
): string {
  const templates = {
    enthusiastic: {
      week: `üí≠ Hey! You have ${count} task${count > 1 ? 's' : ''} from last week. Revisit when you're ready! üòä`,
      two_weeks: `üåü ${count} task${count > 1 ? 's are' : ' is'} hanging around from 2 weeks ago. Still relevant? No pressure! üí´`,
      month: `üì¶ ${count} task${count > 1 ? 's have' : ' has'} been pending for a month. Maybe time to archive or revive? üîÑ`
    },
    gentle: {
      week: `üí≠ ${count} task${count > 1 ? 's' : ''} from last week ${count > 1 ? 'are' : 'is'} resting. Revisit when it feels right.`,
      two_weeks: `üå∏ ${count} older task${count > 1 ? 's' : ''} ${count > 1 ? 'have' : 'has'} been patient. Consider a gentle review.`,
      month: `üìö ${count} task${count > 1 ? 's' : ''} from a month ago. Perhaps time to archive or refresh?`
    },
    professional: {
      week: `${count} task${count > 1 ? 's' : ''} from last week pending review at your convenience.`,
      two_weeks: `${count} task${count > 1 ? 's' : ''} older than 2 weeks require attention or archival.`,
      month: `${count} task${count > 1 ? 's' : ''} pending for 30+ days. Recommend review for relevance.`
    }
  };

  return templates[tone][age];
}

/**
 * Calculate days since task creation.
 */
private getDaysOld(task: Task): number {
  const now = new Date();
  const diff = now.getTime() - task.createdAt.getTime();
  return Math.floor(diff / (1000 * 60 * 60 * 24));
}
```

**Key Principles:**
- No guilt-inducing words: avoid "forgotten", "neglected", "should"
- Provide context: mention age without judgment
- Offer options: "revisit", "archive", or "refresh"
- Include positive frame: reference other achievements
- Respect enableInsights preference
- Group by age for appropriate messaging

### Improvement Suggestion Generation

**Positive Framing Patterns:** [AC: 2]

```typescript
/**
 * Generate improvement suggestions framed as opportunities.
 * Analyzes patterns and provides actionable guidance without criticism.
 *
 * @param summary - Monthly summary data
 * @param accuracy - Estimation accuracy data
 * @param config - User configuration for tone preference
 * @returns Array of improvement suggestion messages
 */
generateImprovementSuggestions(
  summary: MonthlySummary,
  accuracy: AccuracyStats,
  config: Configuration
): string[] {
  // Respect user preference
  if (!config.enableInsights) return [];

  const suggestions: string[] = [];

  // Estimation accuracy opportunities
  if (accuracy.accuracy !== null && accuracy.accuracy < 70) {
    suggestions.push(this.suggestEstimationImprovement(accuracy, config));
  }

  // Productivity day optimization
  if (summary.mostProductiveDay) {
    suggestions.push(this.suggestProductiveDayOptimization(summary, config));
  }

  // Streak building opportunities
  if (summary.longestStreak < 7) {
    suggestions.push(this.suggestStreakBuilding(summary, config));
  }

  // Task breakdown for large tasks
  if (summary.averageActualMinutes && summary.averageActualMinutes > 120) {
    suggestions.push(this.suggestTaskBreakdown(summary, config));
  }

  // Completion rate opportunities
  if (summary.completionRate < 60) {
    suggestions.push(this.suggestCompletionImprovement(summary, config));
  }

  // Limit to top 3 suggestions to avoid overwhelming
  return suggestions.slice(0, 3);
}

/**
 * Suggest estimation improvement as opportunity.
 */
private suggestEstimationImprovement(
  accuracy: AccuracyStats,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üí° Pro tip! Try tracking a few quick tasks first to calibrate your time sense - you'll nail those estimates in no time! üéØ`,
    gentle: `üí° Consider: starting with smaller tasks helps you learn your natural pace. No rush, just gentle awareness.`,
    professional: `üí° Recommendation: Begin with shorter tasks to establish baseline estimation patterns for improved accuracy.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Suggest productive day optimization.
 */
private suggestProductiveDayOptimization(
  summary: MonthlySummary,
  config: Configuration
): string {
  const day = summary.mostProductiveDay;
  const templates = {
    enthusiastic: `üí° You rock on ${day}s! Try scheduling your most important tasks then - ride that productivity wave! üåä`,
    gentle: `üí° ${day} seems to flow well for you. Perhaps schedule key tasks for that day when it feels right.`,
    professional: `üí° Analysis shows peak productivity on ${day}. Consider prioritizing critical tasks accordingly.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Suggest streak building strategies.
 */
private suggestStreakBuilding(
  summary: MonthlySummary,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üí° Challenge yourself! Try completing just one small task daily - you'll build an awesome streak before you know it! üî•`,
    gentle: `üí° Small daily wins add up. One task per day, however tiny, creates gentle consistency.`,
    professional: `üí° Strategy: Complete one task daily to establish consistent productivity patterns and extend streak duration.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Suggest task breakdown for large tasks.
 */
private suggestTaskBreakdown(
  summary: MonthlySummary,
  config: Configuration
): string {
  const avgHours = Math.round(summary.averageActualMinutes! / 60);
  const templates = {
    enthusiastic: `üí° Those ${avgHours}-hour tasks? Break 'em down! Smaller chunks = better estimates + more wins to celebrate! üéâ`,
    gentle: `üí° Your tasks average ${avgHours} hours. Smaller pieces might feel more manageable and easier to estimate.`,
    professional: `üí° Task decomposition recommended: Average duration of ${avgHours} hours suggests opportunities for subdivision to improve estimation accuracy.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Suggest completion rate improvement.
 */
private suggestCompletionImprovement(
  summary: MonthlySummary,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üí° Let's boost that completion rate! Try creating slightly fewer tasks so you can crush each one! üí™`,
    gentle: `üí° You might enjoy creating fewer tasks at once. Less pressure, more completions, better flow.`,
    professional: `üí° Recommendation: Reduce concurrent task volume to improve completion rate and maintain focus.`
  };

  return templates[config.celebrationLanguage];
}
```

**Suggestion Principles:**
- Frame as opportunities, not criticisms
- Use positive action verbs: "try", "consider", "explore"
- Provide specific actionable steps
- Include rationale or benefit
- Limit suggestions to avoid overwhelm (max 3)
- Always include encouraging context

### Contextual Encouragement Engine

**Pattern-Based Messaging:** [AC: 5]

```typescript
/**
 * Generate contextual encouragement based on recent patterns.
 * Adjusts messaging based on trends, performance, and learning phase.
 *
 * @param summary - Current monthly summary
 * @param trends - Historical trends for pattern recognition
 * @param config - User configuration for tone preference
 * @returns Contextual encouragement message
 */
generateContextualEncouragement(
  summary: MonthlySummary,
  trends: HistoricalTrends,
  config: Configuration
): string {
  // Detect pattern type
  const pattern = this.detectProductivityPattern(summary, trends);

  // Generate encouragement based on pattern
  switch (pattern) {
    case 'improving':
      return this.encourageImprovement(summary, trends, config);

    case 'declining':
      return this.encourageRecovery(summary, trends, config);

    case 'consistent':
      return this.encourageConsistency(summary, config);

    case 'learning':
      return this.encourageLearning(summary, config);

    case 'fluctuating':
      return this.encourageStability(summary, trends, config);

    default:
      return this.encourageGeneral(summary, config);
  }
}

/**
 * Detect productivity pattern from recent data.
 */
private detectProductivityPattern(
  summary: MonthlySummary,
  trends: HistoricalTrends
): string {
  const recentMonths = trends.months.slice(0, 3); // Last 3 months
  const completionRates = recentMonths
    .map(m => m.summary?.completionRate)
    .filter(r => r !== null) as number[];

  if (completionRates.length < 2) {
    return 'learning'; // Not enough data
  }

  // Calculate trend
  const firstRate = completionRates[completionRates.length - 1];
  const lastRate = completionRates[0];
  const change = lastRate - firstRate;

  // Improving trend
  if (change > 10) return 'improving';

  // Declining trend
  if (change < -10) return 'declining';

  // Check for consistency (low variance)
  const variance = this.calculateVariance(completionRates);
  if (variance < 5) return 'consistent';

  // Check for fluctuation (high variance)
  if (variance > 15) return 'fluctuating';

  // Default to general
  return 'general';
}

/**
 * Encourage improvement trajectory.
 */
private encourageImprovement(
  summary: MonthlySummary,
  trends: HistoricalTrends,
  config: Configuration
): string {
  const improvement = trends.overallTrends.completionRateImproving;
  const templates = {
    enthusiastic: `üìà You're on a roll! Your completion rate keeps climbing - you're absolutely crushing it! Keep this momentum going! üöÄ`,
    gentle: `üìä Lovely progress. Your completion rate is gently rising. You're finding what works for you.`,
    professional: `üìà Positive trend detected: Completion rate improvement sustained across multiple months. Current trajectory indicates continued growth.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Encourage during declining period.
 */
private encourageRecovery(
  summary: MonthlySummary,
  trends: HistoricalTrends,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üí™ Everyone has ups and downs! You've shown you can do this before - time to bounce back stronger! üåü`,
    gentle: `üå± Life has rhythms. This month was quieter, and that's perfectly okay. Your past success shows your capability.`,
    professional: `üìä Recent performance variance noted. Historical data demonstrates capacity for strong execution. Recommend refocusing on established productive patterns.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Encourage consistent performance.
 */
private encourageConsistency(
  summary: MonthlySummary,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `‚≠ê Rock-solid consistency! You're maintaining ${summary.completionRate}% completion like a pro - that's the secret to long-term success! üéØ`,
    gentle: `üå∏ Beautiful consistency. Your steady ${summary.completionRate}% completion shows you've found your sustainable rhythm.`,
    professional: `üìä Consistent performance maintained: ${summary.completionRate}% completion rate demonstrates established productivity patterns and sustainable workflow.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Encourage during learning phase.
 */
private encourageLearning(
  summary: MonthlySummary,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üìö You're learning your groove! Every task completed teaches you something - keep experimenting and finding what works! üéì`,
    gentle: `üå± Early days. You're discovering your patterns. Be patient with yourself as you learn.`,
    professional: `üìä Initial data collection phase. Continued tracking will enable pattern recognition and optimization opportunities.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Encourage stability during fluctuation.
 */
private encourageStability(
  summary: MonthlySummary,
  trends: HistoricalTrends,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üé¢ Your productivity has some ups and downs! That's totally normal - let's find your steady groove! üí´`,
    gentle: `üåä Some variation in your flow. Perhaps focus on smaller, consistent steps to find stability.`,
    professional: `üìä Performance variance detected. Recommendation: Focus on process consistency to reduce fluctuation and improve predictability.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * General encouragement.
 */
private encourageGeneral(
  summary: MonthlySummary,
  config: Configuration
): string {
  const templates = {
    enthusiastic: `üåü ${summary.completedTasks} tasks done this month! You're making progress and that's what counts! Keep going! üí™`,
    gentle: `‚ú® ${summary.completedTasks} tasks completed. Each one is a step forward. Keep moving at your own pace.`,
    professional: `üìä Monthly summary: ${summary.completedTasks} tasks completed at ${summary.completionRate}% completion rate. Continue tracking for optimization insights.`
  };

  return templates[config.celebrationLanguage];
}

/**
 * Calculate variance for pattern detection.
 */
private calculateVariance(values: number[]): number {
  const mean = values.reduce((a, b) => a + b, 0) / values.length;
  const squaredDiffs = values.map(v => Math.pow(v - mean, 2));
  return Math.sqrt(squaredDiffs.reduce((a, b) => a + b, 0) / values.length);
}
```

**Contextual Patterns:**
- **Improving:** Celebrate momentum and encourage continuation
- **Declining:** Provide support without judgment, reference past success
- **Consistent:** Validate steady performance and sustainability
- **Learning:** Encourage experimentation and patience
- **Fluctuating:** Suggest focus on stability and consistency
- **General:** Provide neutral positive reinforcement

### Configuration Command Specifications

**Command Format:** [AC: 6]

```bash
# Show current configuration
todo config
todo config --show

# Set celebration language
todo config --celebration-language enthusiastic
todo config --celebration-language gentle
todo config --celebration-language professional

# Enable/disable insights
todo config --enable-insights
todo config --disable-insights

# Reset to defaults
todo config --reset

# Combined settings
todo config --celebration-language gentle --enable-insights
```

**Commander.js Implementation:**
```typescript
// packages/cli/src/commands/config.ts

import { Command } from 'commander';
import { ConfigurationService } from '@todo/shared';
import { formatSuccess, formatError } from '../formatters/TaskFormatter';

/**
 * Register configuration command.
 *
 * @param program - Commander program instance
 */
export function registerConfigCommand(program: Command): void {
  program
    .command('config')
    .description('Manage todo application settings and preferences')
    .option('--show', 'Display current configuration')
    .option('--celebration-language <tone>', 'Set celebration tone: enthusiastic|gentle|professional')
    .option('--enable-insights', 'Enable celebration insights and suggestions')
    .option('--disable-insights', 'Disable insights (raw data only)')
    .option('--reset', 'Reset all settings to defaults')
    .action(async (options) => {
      try {
        const service = new ConfigurationService();

        // Reset configuration
        if (options.reset) {
          await service.resetToDefaults();
          console.log(formatSuccess('‚ú® Configuration reset to defaults!'));
          const config = await service.getConfiguration();
          console.log(formatConfiguration(config));
          return;
        }

        // Update configuration
        const updates: any = {};
        let hasUpdates = false;

        if (options.celebrationLanguage) {
          const validTones = ['enthusiastic', 'gentle', 'professional'];
          if (!validTones.includes(options.celebrationLanguage)) {
            throw new Error(`Invalid tone. Choose: ${validTones.join(', ')}`);
          }
          updates.celebrationLanguage = options.celebrationLanguage;
          hasUpdates = true;
        }

        if (options.enableInsights !== undefined) {
          updates.enableInsights = true;
          hasUpdates = true;
        }

        if (options.disableInsights !== undefined) {
          updates.enableInsights = false;
          hasUpdates = true;
        }

        // Apply updates
        if (hasUpdates) {
          await service.updateConfiguration(updates);
          console.log(formatSuccess('‚ú® Configuration updated!'));
        }

        // Show configuration (default or after updates)
        const config = await service.getConfiguration();
        console.log(formatConfiguration(config));

      } catch (error) {
        console.error(formatError(error));
        process.exit(1);
      }
    });
}

/**
 * Format configuration display.
 */
function formatConfiguration(config: Configuration): string {
  const insightsStatus = config.enableInsights ? '‚úÖ Enabled' : '‚ùå Disabled';
  const languageDisplay = {
    enthusiastic: 'üéâ Enthusiastic',
    gentle: 'üå∏ Gentle',
    professional: 'üíº Professional'
  }[config.celebrationLanguage];

  return `
üìã Todo Configuration

Celebration & Insights:
  Language: ${languageDisplay}
  Insights: ${insightsStatus}

Defaults:
  Estimate: ${config.defaultEstimateMinutes} minutes
  Date Format: ${config.dateFormat}
  Time Format: ${config.timeFormat}
  Export Format: ${config.exportFormat}

üí° Tip: Use 'todo config --help' to see all options
`.trim();
}
```

**Configuration Service:**
```typescript
/**
 * Service for managing user configuration.
 */
export class ConfigurationService {
  constructor(private repository: IConfigurationRepository) {}

  /**
   * Get current configuration (singleton).
   */
  async getConfiguration(): Promise<Configuration> {
    return await this.repository.get();
  }

  /**
   * Update configuration with partial changes.
   */
  async updateConfiguration(updates: ConfigurationUpdate): Promise<Configuration> {
    return await this.repository.update(updates);
  }

  /**
   * Reset configuration to default values.
   */
  async resetToDefaults(): Promise<Configuration> {
    const defaults: ConfigurationUpdate = {
      defaultEstimateMinutes: 30,
      celebrationLanguage: 'enthusiastic',
      dateFormat: 'ISO',
      timeFormat: '24h',
      enableInsights: true,
      exportFormat: 'json'
    };
    return await this.repository.update(defaults);
  }
}
```

### Integration with MonthlySummaryService

**Enhanced Monthly Summary Generation:** [AC: 1, 5]

```typescript
/**
 * Enhanced MonthlySummaryService with InsightGenerationService integration.
 */
export class MonthlySummaryService {
  constructor(
    private taskRepository: ITaskRepository,
    private summaryRepository: IMonthlySummaryRepository,
    private configRepository: IConfigurationRepository,
    private insightService: InsightGenerationService,
    private estimationService: EstimationAccuracyService
  ) {}

  /**
   * Generate monthly summary with celebration-focused insights.
   * Integrates milestone detection, gentle reminders, and improvement suggestions.
   *
   * @param month - Month in YYYY-MM format
   * @returns Enhanced monthly summary with insights
   */
  async generateMonthlySummary(month: string): Promise<MonthlySummary> {
    // Get user configuration
    const config = await this.configRepository.get();

    // Fetch month's tasks
    const tasks = await this.fetchMonthTasks(month);

    // Calculate basic metrics
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(t => t.isCompleted).length;
    const completionRate = totalTasks > 0
      ? Math.round((completedTasks / totalTasks) * 100)
      : 0;

    // Calculate productivity metrics
    const streak = this.calculateProductivityStreak(tasks);
    const productiveDay = this.calculateMostProductiveDay(tasks);
    const accuracy = this.estimationService.calculateMonthlyAccuracy(tasks);

    // Get historical trends for context
    const trends = await this.getHistoricalTrends();

    // Generate insights using InsightGenerationService
    const celebrationMessage = this.insightService.generateCelebrationMessage(
      { completionRate, completedTasks, longestStreak: streak.length },
      config,
      trends
    );

    // Detect milestones
    const totalTasksAllTime = await this.getTotalTaskCount();
    const previousMilestones = await this.getPreviousMilestones();
    const milestoneAchievements = this.insightService.detectMilestones(
      { completionRate, completedTasks, longestStreak: streak.length },
      totalTasksAllTime,
      previousMilestones
    );

    // Generate gentle reminders
    const abandonedTasks = tasks.filter(t =>
      !t.isCompleted &&
      this.getDaysOld(t) > 7
    );
    const gentleReminders = this.insightService.generateGentleReminders(
      abandonedTasks,
      config
    );

    // Generate improvement suggestions
    const improvementSuggestions = this.insightService.generateImprovementSuggestions(
      { completionRate, averageActualMinutes, longestStreak: streak.length, mostProductiveDay: productiveDay.day },
      accuracy,
      config
    );

    // Build summary
    const summary: MonthlySummary = {
      id: generateUUID(),
      month,
      totalTasks,
      completedTasks,
      completionRate,
      averageActualMinutes: this.calculateAverageActual(tasks),
      estimationAccuracy: accuracy.accuracy,
      longestStreak: streak.length,
      mostProductiveDay: productiveDay.day,
      celebrationMessage,
      milestoneAchievements,
      gentleReminders,
      improvementSuggestions,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    // Persist summary
    await this.summaryRepository.save(summary);

    // Store achieved milestones
    if (milestoneAchievements.length > 0) {
      await this.storeMilestones(milestoneAchievements);
    }

    return summary;
  }
}
```

### Enhanced Formatter with Insights Sections

**Monthly Summary Output with Insights:** [AC: 1, 2, 3, 4]

```typescript
/**
 * Enhanced MonthlySummaryFormatter with insights sections.
 */
export class MonthlySummaryFormatter {
  /**
   * Format monthly summary with optional insights sections.
   *
   * @param summary - Monthly summary with insights
   * @param config - User configuration for conditional display
   * @returns Formatted string for CLI display
   */
  formatMonthlySummary(
    summary: MonthlySummary,
    config: Configuration
  ): string {
    let output = this.formatHeader(summary);
    output += this.formatTasksOverview(summary);
    output += this.formatTimeEstimation(summary);
    output += this.formatProductivityStreak(summary);
    output += this.formatMostProductiveDay(summary);
    output += this.formatWeeklyChart(summary);

    // Insights sections (only if enabled)
    if (config.enableInsights) {
      output += this.formatMilestones(summary);
      output += this.formatGentleReminders(summary);
      output += this.formatImprovementSuggestions(summary);
    }

    output += this.formatCelebrationMessage(summary);

    return output;
  }

  /**
   * Format milestone achievements section.
   */
  private formatMilestones(summary: MonthlySummary): string {
    if (!summary.milestoneAchievements || summary.milestoneAchievements.length === 0) {
      return '';
    }

    let output = '\nüèÜ Milestone Achievements\n';
    for (const milestone of summary.milestoneAchievements) {
      output += `  ${milestone}\n`;
    }
    return output;
  }

  /**
   * Format gentle reminders section.
   */
  private formatGentleReminders(summary: MonthlySummary): string {
    if (!summary.gentleReminders || summary.gentleReminders.length === 0) {
      return '';
    }

    let output = '\nüí≠ Gentle Reminders\n';
    for (const reminder of summary.gentleReminders) {
      output += `  ${reminder}\n`;
    }
    return output;
  }

  /**
   * Format improvement suggestions section.
   */
  private formatImprovementSuggestions(summary: MonthlySummary): string {
    if (!summary.improvementSuggestions || summary.improvementSuggestions.length === 0) {
      return '';
    }

    let output = '\nüí° Opportunities for Growth\n';
    for (const suggestion of summary.improvementSuggestions) {
      output += `  ${suggestion}\n`;
    }
    return output;
  }
}
```

**Example Output with Insights:**
```
üéâ Monthly Progress Report - September 2025

üìà Tasks Overview
  üéØ Total Created: 75 tasks
  ‚úÖ Completed: 64 tasks
  üìä Completion Rate: 85%

‚è±Ô∏è  Time Estimation
  üéì Accuracy: 87%
  üìè Average Task Duration: 42 minutes

üî• Productivity Streak
  Longest Streak: 14 consecutive days
  üìÖ September 5 - September 18

üí™ Most Productive Day
  üóìÔ∏è  Monday (22 completions - 34% of week's tasks)

üìä Weekly Completion Pattern
[ASCII chart...]

üèÜ Milestone Achievements
  üéØ 50th task completed! Consistency is your superpower!
  üí™ 2-week streak! You're unstoppable!

üí° Opportunities for Growth
  üí° You rock on Mondays! Try scheduling your most important tasks then - ride that productivity wave! üåä
  üí° Challenge yourself! Try completing just one small task daily - you'll build an awesome streak before you know it! üî•

üåü Outstanding month! You completed 85% of your tasks.
   Your 14-day streak shows amazing consistency!

‚ú® Summary saved for future reference
```

### File Locations for New Code

[Source: docs/architecture/source-tree.md]

**Shared Package (Business Logic):**
- Configuration model: `packages/shared/src/models/Configuration.ts`
- Configuration repository interface: `packages/shared/src/repositories/IConfigurationRepository.ts`
- Configuration repository implementation: `packages/shared/src/repositories/SQLiteConfigurationRepository.ts`
- Insight generation service: `packages/shared/src/services/InsightGenerationService.ts`
- Configuration service: `packages/shared/src/services/ConfigurationService.ts`
- Model tests: `packages/shared/__tests__/models/Configuration.test.ts`
- Repository tests: `packages/shared/__tests__/repositories/SQLiteConfigurationRepository.test.ts`
- Service tests: `packages/shared/__tests__/services/InsightGenerationService.test.ts`
- Configuration service tests: `packages/shared/__tests__/services/ConfigurationService.test.ts`

**CLI Package (User Interface):**
- Config command: `packages/cli/src/commands/config.ts`
- Command tests: `packages/cli/__tests__/commands/config.test.ts`
- Integration tests: `packages/cli/__tests__/integration/cli-workflow.test.ts` (extend existing)

**Database:**
- Schema migration: `packages/shared/migrations/003_add_configuration_table.sql`
- Repository uses existing connection from: `packages/shared/src/database/connection.ts`

### Technical Constraints

- **Tone Consistency:** All messaging must maintain chosen tone across all output [Source: docs/architecture/coding-standards.md#critical-rules]
- **Database Operations:** All queries through repository pattern, never direct SQLite [Source: docs/architecture/coding-standards.md#critical-rules]
- **TypeScript:** Strict mode compliance with comprehensive JSDoc documentation [Source: docs/architecture/coding-standards.md#core-standards]
- **Error Handling:** Transform database errors to user-friendly messages [Source: docs/architecture/coding-standards.md#critical-rules]
- **Configuration Singleton:** Single configuration row per user enforced via trigger
- **Insights Toggleable:** All insights respect enableInsights configuration flag [AC: 6]
- **No Guilt Language:** Reminders must avoid judgment and pressure [AC: 4]
- **Positive Framing:** All suggestions framed as opportunities, not criticisms [AC: 2]
- **Celebration Focus:** Lead with accomplishments in all messaging [AC: 1]
- **Context Awareness:** Encouragement based on recent patterns and trends [AC: 5]
- **Milestone Tracking:** Avoid duplicate milestone celebrations via storage
- **Performance:** Insight generation must not impact monthly summary performance (sub-5 second total)

### Testing Standards

[Source: docs/architecture/test-strategy-and-standards.md]

**Test Framework:** Jest 29.7.0 with TypeScript support via ts-jest
**Test Location:** `packages/shared/__tests__/` and `packages/cli/__tests__/` with `.test.ts` suffix
**Coverage Targets:** 80% line coverage for CLI package, 90% for shared package
**Test Types:** Unit tests for services/commands, integration tests for CLI workflows
**Database Testing:** In-memory SQLite for fast execution with isolated databases per test suite

**Specific Test Requirements:**

1. **Configuration Model Tests:**
   - Validate interface structure and type constraints
   - Test ConfigurationUpdate partial updates
   - Verify tone enum validation

2. **SQLiteConfigurationRepository Tests:**
   - Test get (singleton pattern)
   - Test update with partial changes
   - Test reset to defaults
   - Test singleton enforcement (prevent multiple rows)
   - Test database constraint violations

3. **InsightGenerationService Tests:**
   - Test celebration message generation for all three tones
   - Test milestone detection with various patterns
   - Test gentle reminder generation avoiding guilt language
   - Test improvement suggestions framed positively
   - Test contextual encouragement for each pattern type
   - Test respect for enableInsights flag
   - Test tone consistency across all methods

4. **Milestone Detection Tests:**
   - Test task count milestones (1, 10, 50, 100, 500, 1000)
   - Test streak milestones (3, 7, 14, 30, 60 days)
   - Test accuracy milestones (80%, 90%, 95%)
   - Test consistency milestones (streak improvements)
   - Test duplicate prevention

5. **Gentle Reminder Tests:**
   - Test abandoned task detection (>7 days)
   - Test reminder grouping by age
   - Test absence of guilt-inducing language
   - Test respect for enableInsights preference
   - Test empty state (no abandoned tasks)

6. **Improvement Suggestion Tests:**
   - Test estimation accuracy suggestions
   - Test productive day optimization suggestions
   - Test streak building suggestions
   - Test task breakdown suggestions
   - Test completion rate suggestions
   - Test positive framing in all suggestions
   - Test suggestion limiting (max 3)

7. **Contextual Encouragement Tests:**
   - Test improving pattern encouragement
   - Test declining pattern support
   - Test consistent pattern validation
   - Test learning phase encouragement
   - Test fluctuating pattern stability suggestions
   - Test general encouragement
   - Test pattern detection algorithm

8. **Config Command Tests:**
   - Test --show flag
   - Test --celebration-language flag (all three tones)
   - Test --enable-insights flag
   - Test --disable-insights flag
   - Test --reset flag
   - Test invalid tone validation
   - Test combined flags

9. **Integration Tests:**
   - Test end-to-end: tasks ‚Üí milestones ‚Üí monthly with insights
   - Test configuration changes affecting output
   - Test insights disabled (raw data only)
   - Test tone changes across all output
   - Test abandoned task reminders in monthly summary
   - Test milestone storage and retrieval

## Celebration Message Examples

### Example 1: Enthusiastic Tone - High Performance

**Context:** 85% completion rate, 14-day streak, 50th task milestone

**Output:**
```
üåü Outstanding month! You absolutely crushed it with 85% completion! üéâ

üèÜ Milestone Achievements
  üéØ 50th task completed! Consistency is your superpower!
  üí™ 2-week streak! You're unstoppable!

üí° Opportunities for Growth
  üí° You rock on Mondays! Try scheduling your most important tasks then - ride that productivity wave! üåä

üìà You're on a roll! Your completion rate keeps climbing - you're absolutely crushing it! Keep this momentum going! üöÄ
```

### Example 2: Gentle Tone - Learning Phase

**Context:** 52% completion rate, 3-day streak, 10th task milestone

**Output:**
```
‚ú® What a lovely month! You completed 52% of your tasks with grace.

üèÜ Milestone Achievements
  üéØ 10 tasks done! You're building momentum!
  üî• 3-day streak! You're forming a habit!

üí≠ Gentle Reminders
  üí≠ 5 tasks from last week are resting. Revisit them when it feels right.

üí° Opportunities for Growth
  üí° Consider: smaller tasks might feel more manageable for your workflow.

üå± Early days. You're discovering your patterns. Be patient with yourself as you learn.
```

### Example 3: Professional Tone - Consistent Performance

**Context:** 75% completion rate, 8-day streak, 90% accuracy milestone

**Output:**
```
Excellent performance this month: 75% task completion rate achieved.

üèÜ Milestone Achievements
  üéì 90% estimation accuracy! Your time estimates are spot-on!

üí° Opportunities for Growth
  üí° Analysis shows peak productivity on Monday. Consider prioritizing critical tasks accordingly.

üìä Consistent performance maintained: 75% completion rate demonstrates established productivity patterns and sustainable workflow.
```

### Example 4: Abandoned Task Reminders - All Tones

**Enthusiastic:**
```
üí≠ Gentle Reminders
  üí≠ Hey! You have 3 tasks from last week. Revisit when you're ready! üòä
  üì¶ 2 tasks have been pending for a month. Maybe time to archive or revive? üîÑ
```

**Gentle:**
```
üí≠ Gentle Reminders
  üí≠ 3 tasks from last week are resting. Revisit when it feels right.
  üìö 2 tasks from a month ago. Perhaps time to archive or refresh?
```

**Professional:**
```
üí≠ Gentle Reminders
  3 tasks from last week pending review at your convenience.
  2 tasks pending for 30+ days. Recommend review for relevance.
```

### Example 5: Improvement Suggestions - Pattern-Based

**Estimation Accuracy Improvement (65% accuracy):**
- **Enthusiastic:** "üí° Pro tip! Try tracking a few quick tasks first to calibrate your time sense - you'll nail those estimates in no time! üéØ"
- **Gentle:** "üí° Consider: starting with smaller tasks helps you learn your natural pace. No rush, just gentle awareness."
- **Professional:** "üí° Recommendation: Begin with shorter tasks to establish baseline estimation patterns for improved accuracy."

**Productive Day Optimization (Monday most productive):**
- **Enthusiastic:** "üí° You rock on Mondays! Try scheduling your most important tasks then - ride that productivity wave! üåä"
- **Gentle:** "üí° Monday seems to flow well for you. Perhaps schedule key tasks for that day when it feels right."
- **Professional:** "üí° Analysis shows peak productivity on Monday. Consider prioritizing critical tasks accordingly."

**Streak Building (2-day streak):**
- **Enthusiastic:** "üí° Challenge yourself! Try completing just one small task daily - you'll build an awesome streak before you know it! üî•"
- **Gentle:** "üí° Small daily wins add up. One task per day, however tiny, creates gentle consistency."
- **Professional:** "üí° Strategy: Complete one task daily to establish consistent productivity patterns and extend streak duration."

### Example 6: Contextual Encouragement - All Patterns

**Improving Pattern:**
- **Enthusiastic:** "üìà You're on a roll! Your completion rate keeps climbing - you're absolutely crushing it! Keep this momentum going! üöÄ"
- **Gentle:** "üìä Lovely progress. Your completion rate is gently rising. You're finding what works for you."
- **Professional:** "üìà Positive trend detected: Completion rate improvement sustained across multiple months."

**Declining Pattern:**
- **Enthusiastic:** "üí™ Everyone has ups and downs! You've shown you can do this before - time to bounce back stronger! üåü"
- **Gentle:** "üå± Life has rhythms. This month was quieter, and that's perfectly okay. Your past success shows your capability."
- **Professional:** "üìä Recent performance variance noted. Historical data demonstrates capacity for strong execution."

**Consistent Pattern:**
- **Enthusiastic:** "‚≠ê Rock-solid consistency! You're maintaining 75% completion like a pro - that's the secret to long-term success! üéØ"
- **Gentle:** "üå∏ Beautiful consistency. Your steady 75% completion shows you've found your sustainable rhythm."
- **Professional:** "üìä Consistent performance maintained: 75% completion rate demonstrates established productivity patterns."

## Dev Agent Record

### Agent Model Used
[To be filled during development]

### Completion Notes
[To be filled during development]

### File List
[To be filled during development]

### Debug Log References
[To be filled during development]

### Status
Ready for Development

## QA Results

### Review Date
[To be filled during QA review]

### Reviewed By
[To be filled during QA review]

### QA Analysis
[To be filled during QA review]

### Key Findings
[To be filled during QA review]

### Gate Status
[To be filled during QA review]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-30 | 1.0 | Initial story creation with comprehensive celebration-focused insights, three tone preferences, milestone detection, gentle reminders, improvement suggestions, contextual encouragement, and configuration management | Bob (Scrum Master) |
